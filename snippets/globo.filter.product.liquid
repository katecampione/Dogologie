{% raw %}
  {% assign root_url = {% endraw %}"{%- if routes.root_url != "/" -%}{{ routes.root_url }}{%- endif -%}"{% raw %} %}
  {% assign currencyFormat = {% endraw %}{{ shop.money_format | json }}{% raw %} %}
  {% assign swatch_options = 'Colour~~Color' | downcase | split: "~~" | uniq  %}
  {% assign image_options  = '' | downcase | split: "~~" | uniq  %}
  {% assign text_options   = 'Size' | downcase | split: "~~" | uniq  %}
  {% assign show_selected_variant_info = true %}
 
  {% assign image_size     = '360x504' %}
  {% assign images_count   = product.images | size %}
  {% assign variants_count = product.variants | size %}
  {% assign options_count  = product.options | size %}
  {% assign no_image = 'https://cdn.shopify.com/s/images/themes/product-1.png' %}

  {% assign featured_image            = product.featured_image %}
  {% assign product_price             = product.price %}
  {% assign product_compare_at_price  = product.compare_at_price %}
  {% assign second_image_index        = 2 %}
  {% assign selected_or_first_available_variant = product.selected_or_first_available_variant %}
  {% assign variant_url = '' %}
  {% if product.selected_or_first_available_variant %}{% assign variant_url = '?variant=' | append: product.selected_or_first_available_variant.id %}{% endif %}  {% if show_selected_variant_info and product.selected_variant %}
    {% assign selected_or_first_available_variant = product.selected_variant %}
    {% assign product_price             = selected_or_first_available_variant.price %}
    {% assign product_compare_at_price  = selected_or_first_available_variant.compare_at_price %}
    {% if selected_or_first_available_variant.image %}
      {% assign featured_image = selected_or_first_available_variant.image %}
    {% endif %}
  {% endif %}

  {% for image in product.images %}
    {% if image.id == featured_image.id %}
      {% if forloop.index == images_count %}
        {% assign second_image_index = 1 %}
      {% else %}
        {% assign second_image_index = forloop.index | plus: 1 %}
      {% endif %}
    {% endif %}
  {% endfor %}

            {% assign onboarding = false %}
  {% assign product = product | default: nil %}
  {% assign enable_product_details_overlay = settings.enable_product_details_overlay %}
  {% assign brandNames = settings['show-brand-names'] %}
  {% assign media_borders = settings.media_borders %}
  {% assign enableATC = settings.show_atc %}
  {% assign enableQuickshop = settings['enable-quick-shop'] %}
  {% assign onboarding = onboarding | default: false %}
  {% assign selected_variant = product.selected_or_first_available_variant %}

  {% if enable_product_details_overlay %}
  {% capture cardType %} product-card-alt{% endcapture %}
  {% endif %}

  {% capture product_card_details %}
  <div class="product-card-details">
    {% if brandNames %}
      <h3 class="brand">
        {% if onboarding %}
          {% endraw %}{{ 'onboarding.product_vendor' | t }}{% raw %}
        {% else %}
          {{ product.vendor | link_to_vendor }}
        {% endif %}
      </h3>
    {% endif %}

    <h2 class="title">
      {% if onboarding %}
        {% endraw %}{{ 'onboarding.product_name' | t }}{% raw %}
      {% else %}
        <a href="{{ product.url | within: collection }}{{variant_url}}">
          {{ product.title }}
        </a>
      {% endif %}
    </h2>
    {% assign itemType = product %}

    <div class="product-item__price">
      {% if onboarding %}
        <span class="money money--last">{% endraw %}{{ 'onboarding.product_price' | t }}{% raw %}</span>
      {% else %}
        {% if itemType.compare_at_price_min > itemType.price_min %}
          <span class="original money"> {{ itemType.compare_at_price_min | money }}</span> <span class="money money--last">{{ itemType.price_min | money }}</span>
        {% else %}
          <span class="money money--last">{{ itemType.price_min | money }}</span>
        {% endif %}
      {% endif %}
    </div>

    
  </div>
  {% endcapture %}

  {% capture product_card_details_overlay %}
  <div class="product-card-details">
    {% if brandNames %}
      <h3 class="brand">
        {% if onboarding %}
          {% endraw %}{{ 'onboarding.product_vendor' | t }}{% raw %}
        {% else %}
          {{ product.vendor }}
        {% endif %}
      </h3>
    {% endif %}

    <h2 class="title">
      {% if onboarding %}
        {% endraw %}{{ 'onboarding.product_name' | t }}{% raw %}
      {% else %}
        {{ product.title }}
      {% endif %}
    </h2>
    {% assign itemType = product %}

    <div class="product-item__price">
      {% if onboarding %}
        <span class="money money--last">{% endraw %}{{ 'onboarding.product_price' | t }}{% raw %}</span>
      {% else %}
        {% if itemType.compare_at_price_min > itemType.price_min %}
          <span class="original money"> {{ itemType.compare_at_price_min | money }}</span> <span class="money money--last">{{ itemType.price_min | money }}</span>
        {% else %}
          <span class="money money--last">{{ itemType.price_min | money }}</span>
        {% endif %}
      {% endif %}
    </div>

    
  </div>
  {% endcapture %}

  {% capture product_card_interactions %}
  <div class="product-card-interactions">
    {% if enableQuickshop %}
      <button
        class="product-card-interaction product-card-interaction-quickshop"
        data-product-card-interaction-quickshop
        data-product-url="{{ product.url | within: collection }}"
        {% if onboarding %}
          disabled
        {% endif %}
      >
        {% endraw %}{{ 'products.product_item.quickshop' | t }}{% raw %}
      </button>
    {% endif %}

    {% if enableATC %}
      <button
        class="product-card-interaction product-card-interaction-addtocart"
        {% unless selected_variant.available %}
          disabled
        {% endunless %}
        {% if onboarding %}
          disabled
        {% endif %}
        data-product-card-interaction-addtocart
        data-product-variant-id="{{ product.selected_or_first_available_variant.id }}"
        data-cart-redirect="{{ settings.quickshop_enable_cart_redirect | json }}"
      >
        <span class="product-card-interaction-addtocart-available">
          {% if selected_variant.available %}
            {% endraw %}{{ 'products.product_item.add_to_cart' | t }}{% raw %}
          {% else %}
            {% endraw %}{{ 'products.product_item.sold_out' | t }}{% raw %}
          {% endif %}
        </span>

        <span class="product-card-interaction-addtocart-error">
          {% endraw %}{{ 'products.product_item.unavailable' | t }}{% raw %}
        </span>

        <div class="product-card-interaction-addtocart-spinner">
          <svg class="svg-icon icon-spinner" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
            <path fill="currentColor" fill-rule="evenodd" d="M1.0436 10.9683C1.47582 10.9683 1.8262 11.3255 1.8262 11.7661C1.8262 17.4946 6.38122 22.1385 12.0001 22.1385C17.619 22.1385 22.174 17.4946 22.174 11.7661C22.174 11.3255 22.5244 10.9683 22.9566 10.9683C23.3889 10.9683 23.7392 11.3255 23.7392 11.7661C23.7392 18.3759 18.4835 23.7342 12.0001 23.7342C5.51677 23.7342 0.260986 18.3759 0.260986 11.7661C0.260986 11.3255 0.611372 10.9683 1.0436 10.9683Z"/>
          </svg>
        </div>
      </button>
    {% endif %}
  </div>
  {% endcapture %}

  <li{% if showPageData %} data-page="{{page}}"{% endif %}
  class="
    product
    product-{{ product.id }}
    {% if forloop.first %}first{% endif %} {% if forloop.last %}last{% endif %}
    {{ cardType }}
  "
  data-product-item
  >
  {% assign productImageSize = 'grande' %}

  <div class="product-inner">
    <figure class="product-card-figure">
            {% if product.image %}
        {% assign img = product.featured_image %}
        {% assign size = '600x' %}
        {% assign lazy = true %}
        {%- capture _ -%}
          {% assign lazy = lazy | default: false %}
          {% assign background = background | default: false %}
          {% assign size_default = img.width | append: 'x' | append: img.height %}
          {% assign size = size | default: size_default %}
          {% assign crop = crop | default: false %}
          {% assign scale = scale | default: 1 %}
          {% assign format = format | default: '' %}
          {% assign placeholder = placeholder | default: false %}
          {% assign alt = alt | default: img.alt | default: '' %}
          {% assign class = class | default: blank %}
          {% assign style = style | default: blank %}
          {% assign attr = attr | default: blank %}
          {% assign canvas = canvas | default: false %}
          {% assign disable_noscript = disable_noscript | default: false %}

          {% comment %}
            Parse size parameter and force to numbers.
          {% endcomment %}
          {% assign rimg_s = size | split: 'x' %}
          {% assign rimg_w = rimg_s[0] %}
          {% assign rimg_h = rimg_s[1] %}
          {% assign rimg_size_aspect_ratio = rimg_w | times: 1.0 | divided_by: rimg_h %}

          {% comment %}
            Calculate width and height based on the size parameter.
          {% endcomment %}
          {% if rimg_w == blank and rimg_h == blank %}
            {% assign rimg_w = img.width %}
            {% assign rimg_h = img.height %}

          {% comment %} Size to a specific height {% endcomment %}
          {% elsif rimg_w == blank %}
            {% assign rimg_w = rimg_h | times: img.aspect_ratio %}
            {% if rimg_w > img.width %}
              {% assign rimg_w = img.width %}
              {% assign rimg_h = rimg_w | divided_by: img.aspect_ratio %}
            {% endif %}

          {% comment %} Size to a specific width {% endcomment %}
          {% elsif rimg_h == blank %}
            {% assign rimg_h = rimg_w | divided_by: img.aspect_ratio %}
            {% if rimg_h > img.height %}
              {% assign rimg_h = img.height %}
              {% assign rimg_w = rimg_h | times: img.aspect_ratio %}
            {% endif %}

          {% comment %} Size to a width and height, no crop {% endcomment %}
          {% elsif crop == blank %}
            {% if img.aspect_ratio > rimg_size_aspect_ratio %}
              {% assign rimg_h = rimg_w | divided_by: img.aspect_ratio %}
              {% if rimg_h > img.height %}
                {% assign rimg_h = img.height %}
                {% assign rimg_w = rimg_h | times: img.aspect_ratio %}
              {% endif %}

            {% else %}
              {% assign rimg_w = rimg_h | times: img.aspect_ratio %}
              {% if rimg_w > img.width %}
                {% assign rimg_w = img.width %}
                {% assign rimg_h = rimg_w | divided_by: img.aspect_ratio %}
              {% endif %}
            {% endif %}

          {% comment %} Otherwise we are sizing to a width and height, and cropping.
          If requested size is larger than the image size then we should use the
          largest possible size while maintaining the requested aspect ratio. {% endcomment %}
          {% else %}
            {% if img.aspect_ratio > rimg_size_aspect_ratio %}
              {% comment %} fit height {% endcomment %}
              {% assign rimg_h = rimg_w | divided_by: rimg_size_aspect_ratio %}
              {% if rimg_h > img.height or rimg_w > img.width  %}
                {% assign rimg_h = img.height %}
                {% assign rimg_w = rimg_h | times: rimg_size_aspect_ratio %}
              {% endif %}

            {% else %}
              {% comment %} fit width {% endcomment %}
              {% assign rimg_w = rimg_h | times: rimg_size_aspect_ratio %}
              {% if rimg_h > img.height or rimg_w > img.width %}
                {% assign rimg_w = img.width %}
                {% assign rimg_h = rimg_w | divided_by: rimg_size_aspect_ratio %}
              {% endif %}

            {% endif %}

          {% endif %}

          {% assign rimg_w = rimg_w | ceil %}
          {% assign rimg_h = rimg_h | ceil %}

          {% assign rimg_size = '' | append: rimg_w | append: 'x' | append: rimg_h %}

          {% comment %}
            Set the scale, default to 1.
          {% endcomment %}
          {% assign rimg_scale = scale %}

          {% comment %}
            Set the format
          {% endcomment %}
          {% assign rimg_format = format %}

          {% comment %}
            Try to guess the alt text based off the image if none is provided.
          {% endcomment %}
          {% assign rimg_alt = alt | escape %}

          {% comment %}
            Define a URL template. We use this to generate exact-size URLs in JS.
          {% endcomment %}
          {% assign rimg_url_template = img
            | img_url: '1x1', crop: crop
            | replace: '_1x1', '_{size}'
          %}

          {% unless rimg_format == '' %}
            {% assign rimg_url_template = img
              | img_url: '1x1', crop: crop, format: rimg_format
              | replace: '_1x1', '_{size}'
            %}
          {% endunless %}

          {% comment %}
            Define a placeholder SVG that shares the image's aspect ratio.

            Setting the image's initial `srcset` attribute to this inline SVG allows the
            image to have the correct aspect ratio before we actually load the image.
          {% endcomment %}
          {% assign rimg_placeholder = 'data:image/svg+xml;utf8,'
            | append: "<svg xmlns='http://www.w3.org/2000/svg' width='X' height='Y'></svg>"
            | replace: 'X', rimg_w
            | replace: 'Y', rimg_h
            | replace: ' ', '%20'
          %}

          {% comment %}
            Generate a `srcset` string.
          {% endcomment %}
          {% assign rimg_density = '' %}
          {% for i in (1..4) %}
            {% assign rimg_densities_w = rimg_w | times: i | round %}
            {% assign rimg_densities_h = rimg_h | times: i | round %}

            {% assign rimg_density = rimg_density | append: ' ' %}

            {% if rimg_densities_w > img.width or rimg_densities_h > img.height %}
              {% if img.aspect_ratio > rimg_size_aspect_ratio %}
                {% assign rimg_max_density = img.height | divided_by: rimg_h %}
                {% assign rimg_max_density_float = img.height | times: 100 | divided_by: rimg_h | times: 0.01 %}
              {% else %}
                {% assign rimg_max_density = img.width | divided_by: rimg_w %}
                {% assign rimg_max_density_float = img.width | times: 100 | divided_by: rimg_w | times: 0.01 %}
              {% endif %}

              {% if rimg_max_density != rimg_max_density_float %}
                {% assign rimg_max_density = rimg_max_density_float %}
              {% endif %}

              {% unless rimg_density contains rimg_max_density %}
                {% assign rimg_density = rimg_density | append: rimg_max_density %}
              {% endunless %}
              {% break %}
            {% else %}
              {% assign rimg_density = rimg_density | append: i %}
            {% endif %}
          {% endfor %}

          {% assign rimg_densities = rimg_density | split: ' ' %}
          {% assign rimg_density_srcset = '' %}
          {% for rimg_densities_i in rimg_densities %}
            {% assign rimg_densities_w = rimg_w | times: rimg_densities_i | round %}
            {% assign rimg_densities_h = rimg_h | times: rimg_densities_i | round %}

            {% assign rimg_densities_size = rimg_densities_w | append: 'x' | append: rimg_densities_h %}
            {% assign rimg_density_src = img | img_url: rimg_densities_size, crop: crop %}

            {% unless rimg_format == '' %}
              {% assign rimg_density_src = img | img_url: rimg_densities_size, crop: crop, format: rimg_format %}
            {% endunless %}

            {% assign rimg_density_srcset = rimg_density_srcset | append: ', ' | append: rimg_density_src | append: ' ' | append: rimg_densities_i | append: 'x' %}
          {% endfor %}
          {% assign rimg_density_srcset = rimg_density_srcset | remove_first: ', ' %}

        {%- endcapture -%}

        {% comment %} Background image {% endcomment %}
        {% if background %}
          {% if lazy %}
            data-rimg="lazy"
            data-rimg-scale="{{ rimg_scale }}"
            data-rimg-template="{{ rimg_url_template }}"
            data-rimg-max="{{ img.width }}x{{ img.height }}"
            data-rimg-crop="{{ crop }}"
            {% if placeholder %}data-rimg-placeholder="{{ placeholder }}"{% endif %}
            {% if class != blank %}class="{{ class }}"{% endif %}
            {% if style != blank %}style="{{ style }}"{% endif %}
            {% if attr != blank %}{{ attr }}{% endif %}

          {% else %}
            {% if class != blank %}class="{{ class }}"{% endif %}
            style="
              {% if rimg_format == '' %}
                background-image: url('{{ img | img_url: rimg_size, crop: crop }}');
              {% else %}
                background-image: url('{{ img | img_url: rimg_size, format: rimg_format }}');
              {% endif %}

              {% if style != blank %}{{ style }}{% endif %}
            "
            {% if attr != blank %}{{ attr }}{% endif %}

          {% endif %}

        {% comment %} Image tag {% endcomment %}
        {% else %}
          {% if lazy and disable_noscript != true %}
            <noscript data-rimg-noscript>
              <img
                {% if rimg_format == '' %}
                  src="{{ img | img_url: rimg_size, crop: crop }}"
                {% else %}
                  src="{{ img | img_url: rimg_size, crop: crop, format: rimg_format }}"
                {% endif %}

                alt="{{ rimg_alt }}"
                data-rimg="noscript"
                srcset="{{ rimg_density_srcset }}"
                {% if class != blank %}class="{{ class }}"{% endif %}
                {% if style != blank %}style="{{ style }}"{% endif %}
                {% if attr != blank %}{{ attr }}{% endif %}
              >
            </noscript>
          {% endif %}

          <img
            {% if rimg_format == '' %}
              src="{{ img | img_url: rimg_size, crop: crop }}"
            {% else %}
              src="{{ img | img_url: rimg_size, crop: crop, format: rimg_format }}"
            {% endif %}
            alt="{{ rimg_alt }}"

            {% if lazy %}
              data-rimg="lazy"
              data-rimg-scale="{{ rimg_scale }}"
              data-rimg-template="{{ rimg_url_template }}"
              data-rimg-max="{{ img.width }}x{{ img.height }}"
              data-rimg-crop="{{ crop }}"
              {% if placeholder %}data-rimg-placeholder="{{ placeholder }}"{% endif %}
              srcset="{{ rimg_placeholder }}"
            {% else %}
              data-rimg
              srcset="{{ rimg_density_srcset }}"
            {% endif %}

            {% if class != blank %}class="{{ class }}"{% endif %}
            {% if style != blank %}style="{{ style }}"{% endif %}
            {% if attr != blank %}{{ attr }}{% endif %}
          >
        {% endif %}

        {% if canvas %}
          <div data-rimg-canvas></div>
        {% endif %}

        {%- capture _ -%}
          {% comment %}
            Unset all parameters so they don't leak between snippet calls.
          {% endcomment %}
          {% assign lazy = nil %}
          {% assign background = nil %}
          {% assign size = nil %}
          {% assign crop = nil %}
          {% assign scale = nil %}
          {% assign format = nil %}
          {% assign placeholder = nil %}
          {% assign alt = nil %}
          {% assign class = nil %}
          {% assign style = nil %}
          {% assign attr = nil %}
          {% assign canvas = nil %}
          {% assign disable_noscript = nil %}
          {% comment %}
            Unset all local variables so they don't pollute the global scope.
          {% endcomment %}
          {% assign rimg_s = blank %}
          {% assign rimg_w = blank %}
          {% assign rimg_h = blank %}
          {% assign rimg_size_aspect_ratio = blank %}
          {% assign rimg_scale = blank %}
          {% assign rimg_url_template = blank %}
          {% assign rimg_alt = blank %}
          {% assign rimg_density = blank %}
          {% assign rimg_densities = blank %}
          {% assign rimg_densities_i = blank %}
          {% assign rimg_densities_w = blank %}
          {% assign rimg_densities_h = blank %}
          {% assign rimg_density_src = blank %}
          {% assign rimg_densities_size = blank %}
          {% assign rimg_density_srcset = blank %}
          {% assign rimg_placeholder = blank %}
        {%- endcapture -%}

        {% if settings.show_product_secondary_image and images_count > 1 %}
          {% assign img = product.images[1] %}
          {% assign size = '600x' %}
          {% assign lazy = true %}
      {%- capture _ -%}
          {% assign lazy = lazy | default: false %}
          {% assign background = background | default: false %}
          {% assign size_default = img.width | append: 'x' | append: img.height %}
          {% assign size = size | default: size_default %}
          {% assign crop = crop | default: false %}
          {% assign scale = scale | default: 1 %}
          {% assign format = format | default: '' %}
          {% assign placeholder = placeholder | default: false %}
          {% assign alt = alt | default: img.alt | default: '' %}
          {% assign class = class | default: blank %}
          {% assign style = style | default: blank %}
          {% assign attr = attr | default: blank %}
          {% assign canvas = canvas | default: false %}
          {% assign disable_noscript = disable_noscript | default: false %}

          {% comment %}
            Parse size parameter and force to numbers.
          {% endcomment %}
          {% assign rimg_s = size | split: 'x' %}
          {% assign rimg_w = rimg_s[0] %}
          {% assign rimg_h = rimg_s[1] %}
          {% assign rimg_size_aspect_ratio = rimg_w | times: 1.0 | divided_by: rimg_h %}

          {% comment %}
            Calculate width and height based on the size parameter.
          {% endcomment %}
          {% if rimg_w == blank and rimg_h == blank %}
            {% assign rimg_w = img.width %}
            {% assign rimg_h = img.height %}

          {% comment %} Size to a specific height {% endcomment %}
          {% elsif rimg_w == blank %}
            {% assign rimg_w = rimg_h | times: img.aspect_ratio %}
            {% if rimg_w > img.width %}
              {% assign rimg_w = img.width %}
              {% assign rimg_h = rimg_w | divided_by: img.aspect_ratio %}
            {% endif %}

          {% comment %} Size to a specific width {% endcomment %}
          {% elsif rimg_h == blank %}
            {% assign rimg_h = rimg_w | divided_by: img.aspect_ratio %}
            {% if rimg_h > img.height %}
              {% assign rimg_h = img.height %}
              {% assign rimg_w = rimg_h | times: img.aspect_ratio %}
            {% endif %}

          {% comment %} Size to a width and height, no crop {% endcomment %}
          {% elsif crop == blank %}
            {% if img.aspect_ratio > rimg_size_aspect_ratio %}
              {% assign rimg_h = rimg_w | divided_by: img.aspect_ratio %}
              {% if rimg_h > img.height %}
                {% assign rimg_h = img.height %}
                {% assign rimg_w = rimg_h | times: img.aspect_ratio %}
              {% endif %}

            {% else %}
              {% assign rimg_w = rimg_h | times: img.aspect_ratio %}
              {% if rimg_w > img.width %}
                {% assign rimg_w = img.width %}
                {% assign rimg_h = rimg_w | divided_by: img.aspect_ratio %}
              {% endif %}
            {% endif %}

          {% comment %} Otherwise we are sizing to a width and height, and cropping.
          If requested size is larger than the image size then we should use the
          largest possible size while maintaining the requested aspect ratio. {% endcomment %}
          {% else %}
            {% if img.aspect_ratio > rimg_size_aspect_ratio %}
              {% comment %} fit height {% endcomment %}
              {% assign rimg_h = rimg_w | divided_by: rimg_size_aspect_ratio %}
              {% if rimg_h > img.height or rimg_w > img.width  %}
                {% assign rimg_h = img.height %}
                {% assign rimg_w = rimg_h | times: rimg_size_aspect_ratio %}
              {% endif %}

            {% else %}
              {% comment %} fit width {% endcomment %}
              {% assign rimg_w = rimg_h | times: rimg_size_aspect_ratio %}
              {% if rimg_h > img.height or rimg_w > img.width %}
                {% assign rimg_w = img.width %}
                {% assign rimg_h = rimg_w | divided_by: rimg_size_aspect_ratio %}
              {% endif %}

            {% endif %}

          {% endif %}

          {% assign rimg_w = rimg_w | ceil %}
          {% assign rimg_h = rimg_h | ceil %}

          {% assign rimg_size = '' | append: rimg_w | append: 'x' | append: rimg_h %}

          {% comment %}
            Set the scale, default to 1.
          {% endcomment %}
          {% assign rimg_scale = scale %}

          {% comment %}
            Set the format
          {% endcomment %}
          {% assign rimg_format = format %}

          {% comment %}
            Try to guess the alt text based off the image if none is provided.
          {% endcomment %}
          {% assign rimg_alt = alt | escape %}

          {% comment %}
            Define a URL template. We use this to generate exact-size URLs in JS.
          {% endcomment %}
          {% assign rimg_url_template = img
            | img_url: '1x1', crop: crop
            | replace: '_1x1', '_{size}'
          %}

          {% unless rimg_format == '' %}
            {% assign rimg_url_template = img
              | img_url: '1x1', crop: crop, format: rimg_format
              | replace: '_1x1', '_{size}'
            %}
          {% endunless %}

          {% comment %}
            Define a placeholder SVG that shares the image's aspect ratio.

            Setting the image's initial `srcset` attribute to this inline SVG allows the
            image to have the correct aspect ratio before we actually load the image.
          {% endcomment %}
          {% assign rimg_placeholder = 'data:image/svg+xml;utf8,'
            | append: "<svg xmlns='http://www.w3.org/2000/svg' width='X' height='Y'></svg>"
            | replace: 'X', rimg_w
            | replace: 'Y', rimg_h
            | replace: ' ', '%20'
          %}

          {% comment %}
            Generate a `srcset` string.
          {% endcomment %}
          {% assign rimg_density = '' %}
          {% for i in (1..4) %}
            {% assign rimg_densities_w = rimg_w | times: i | round %}
            {% assign rimg_densities_h = rimg_h | times: i | round %}

            {% assign rimg_density = rimg_density | append: ' ' %}

            {% if rimg_densities_w > img.width or rimg_densities_h > img.height %}
              {% if img.aspect_ratio > rimg_size_aspect_ratio %}
                {% assign rimg_max_density = img.height | divided_by: rimg_h %}
                {% assign rimg_max_density_float = img.height | times: 100 | divided_by: rimg_h | times: 0.01 %}
              {% else %}
                {% assign rimg_max_density = img.width | divided_by: rimg_w %}
                {% assign rimg_max_density_float = img.width | times: 100 | divided_by: rimg_w | times: 0.01 %}
              {% endif %}

              {% if rimg_max_density != rimg_max_density_float %}
                {% assign rimg_max_density = rimg_max_density_float %}
              {% endif %}

              {% unless rimg_density contains rimg_max_density %}
                {% assign rimg_density = rimg_density | append: rimg_max_density %}
              {% endunless %}
              {% break %}
            {% else %}
              {% assign rimg_density = rimg_density | append: i %}
            {% endif %}
          {% endfor %}

          {% assign rimg_densities = rimg_density | split: ' ' %}
          {% assign rimg_density_srcset = '' %}
          {% for rimg_densities_i in rimg_densities %}
            {% assign rimg_densities_w = rimg_w | times: rimg_densities_i | round %}
            {% assign rimg_densities_h = rimg_h | times: rimg_densities_i | round %}

            {% assign rimg_densities_size = rimg_densities_w | append: 'x' | append: rimg_densities_h %}
            {% assign rimg_density_src = img | img_url: rimg_densities_size, crop: crop %}

            {% unless rimg_format == '' %}
              {% assign rimg_density_src = img | img_url: rimg_densities_size, crop: crop, format: rimg_format %}
            {% endunless %}

            {% assign rimg_density_srcset = rimg_density_srcset | append: ', ' | append: rimg_density_src | append: ' ' | append: rimg_densities_i | append: 'x' %}
          {% endfor %}
          {% assign rimg_density_srcset = rimg_density_srcset | remove_first: ', ' %}

        {%- endcapture -%}

        {% comment %} Background image {% endcomment %}
        {% if background %}
          {% if lazy %}
            data-rimg="lazy"
            data-rimg-scale="{{ rimg_scale }}"
            data-rimg-template="{{ rimg_url_template }}"
            data-rimg-max="{{ img.width }}x{{ img.height }}"
            data-rimg-crop="{{ crop }}"
            {% if placeholder %}data-rimg-placeholder="{{ placeholder }}"{% endif %}
            {% if class != blank %}class="{{ class }}"{% endif %}
            {% if style != blank %}style="{{ style }}"{% endif %}
            {% if attr != blank %}{{ attr }}{% endif %}

          {% else %}
            {% if class != blank %}class="{{ class }}"{% endif %}
            style="
              {% if rimg_format == '' %}
                background-image: url('{{ img | img_url: rimg_size, crop: crop }}');
              {% else %}
                background-image: url('{{ img | img_url: rimg_size, format: rimg_format }}');
              {% endif %}

              {% if style != blank %}{{ style }}{% endif %}
            "
            {% if attr != blank %}{{ attr }}{% endif %}

          {% endif %}

        {% comment %} Image tag {% endcomment %}
        {% else %}
          {% if lazy and disable_noscript != true %}
            <noscript data-rimg-noscript>
              <img
                {% if rimg_format == '' %}
                  src="{{ img | img_url: rimg_size, crop: crop }}"
                {% else %}
                  src="{{ img | img_url: rimg_size, crop: crop, format: rimg_format }}"
                {% endif %}

                alt="{{ rimg_alt }}"
                data-rimg="noscript"
                srcset="{{ rimg_density_srcset }}"
                {% if class != blank %}class="{{ class }}"{% endif %}
                {% if style != blank %}style="{{ style }}"{% endif %}
                {% if attr != blank %}{{ attr }}{% endif %}
              >
            </noscript>
          {% endif %}

          <img
            {% if rimg_format == '' %}
              src="{{ img | img_url: rimg_size, crop: crop }}"
            {% else %}
              src="{{ img | img_url: rimg_size, crop: crop, format: rimg_format }}"
            {% endif %}
            alt="{{ rimg_alt }}"

            {% if lazy %}
              data-rimg="lazy"
              data-rimg-scale="{{ rimg_scale }}"
              data-rimg-template="{{ rimg_url_template }}"
              data-rimg-max="{{ img.width }}x{{ img.height }}"
              data-rimg-crop="{{ crop }}"
              {% if placeholder %}data-rimg-placeholder="{{ placeholder }}"{% endif %}
              srcset="{{ rimg_placeholder }}"
            {% else %}
              data-rimg
              srcset="{{ rimg_density_srcset }}"
            {% endif %}

            {% if class != blank %}class="{{ class }}"{% endif %}
            {% if style != blank %}style="{{ style }}"{% endif %}
            {% if attr != blank %}{{ attr }}{% endif %}
          >
        {% endif %}

        {% if canvas %}
          <div data-rimg-canvas></div>
        {% endif %}

        {%- capture _ -%}
          {% comment %}
            Unset all parameters so they don't leak between snippet calls.
          {% endcomment %}
          {% assign lazy = nil %}
          {% assign background = nil %}
          {% assign size = nil %}
          {% assign crop = nil %}
          {% assign scale = nil %}
          {% assign format = nil %}
          {% assign placeholder = nil %}
          {% assign alt = nil %}
          {% assign class = nil %}
          {% assign style = nil %}
          {% assign attr = nil %}
          {% assign canvas = nil %}
          {% assign disable_noscript = nil %}
          {% comment %}
            Unset all local variables so they don't pollute the global scope.
          {% endcomment %}
          {% assign rimg_s = blank %}
          {% assign rimg_w = blank %}
          {% assign rimg_h = blank %}
          {% assign rimg_size_aspect_ratio = blank %}
          {% assign rimg_scale = blank %}
          {% assign rimg_url_template = blank %}
          {% assign rimg_alt = blank %}
          {% assign rimg_density = blank %}
          {% assign rimg_densities = blank %}
          {% assign rimg_densities_i = blank %}
          {% assign rimg_densities_w = blank %}
          {% assign rimg_densities_h = blank %}
          {% assign rimg_density_src = blank %}
          {% assign rimg_densities_size = blank %}
          {% assign rimg_density_srcset = blank %}
          {% assign rimg_placeholder = blank %}
        {%- endcapture -%}
        {% endif %}
      {% else %}
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 525.5 525.5"><path d="M375.5 345.2c0-.1 0-.1 0 0 0-.1 0-.1 0 0-1.1-2.9-2.3-5.5-3.4-7.8-1.4-4.7-2.4-13.8-.5-19.8 3.4-10.6 3.6-40.6 1.2-54.5-2.3-14-12.3-29.8-18.5-36.9-5.3-6.2-12.8-14.9-15.4-17.9 8.6-5.6 13.3-13.3 14-23 0-.3 0-.6.1-.8.4-4.1-.6-9.9-3.9-13.5-2.1-2.3-4.8-3.5-8-3.5h-54.9c-.8-7.1-3-13-5.2-17.5-6.8-13.9-12.5-16.5-21.2-16.5h-.7c-8.7 0-14.4 2.5-21.2 16.5-2.2 4.5-4.4 10.4-5.2 17.5h-48.5c-3.2 0-5.9 1.2-8 3.5-3.2 3.6-4.3 9.3-3.9 13.5 0 .2 0 .5.1.8.7 9.8 5.4 17.4 14 23-2.6 3.1-10.1 11.7-15.4 17.9-6.1 7.2-16.1 22.9-18.5 36.9-2.2 13.3-1.2 47.4 1 54.9 1.1 3.8 1.4 14.5-.2 19.4-1.2 2.4-2.3 5-3.4 7.9-4.4 11.6-6.2 26.3-5 32.6 1.8 9.9 16.5 14.4 29.4 14.4h176.8c12.9 0 27.6-4.5 29.4-14.4 1.2-6.5-.5-21.1-5-32.7zm-97.7-178c.3-3.2.8-10.6-.2-18 2.4 4.3 5 10.5 5.9 18h-5.7zm-36.3-17.9c-1 7.4-.5 14.8-.2 18h-5.7c.9-7.5 3.5-13.7 5.9-18zm4.5-6.9c0-.1.1-.2.1-.4 4.4-5.3 8.4-5.8 13.1-5.8h.7c4.7 0 8.7.6 13.1 5.8 0 .1 0 .2.1.4 3.2 8.9 2.2 21.2 1.8 25h-30.7c-.4-3.8-1.3-16.1 1.8-25zm-70.7 42.5c0-.3 0-.6-.1-.9-.3-3.4.5-8.4 3.1-11.3 1-1.1 2.1-1.7 3.4-2.1l-.6.6c-2.8 3.1-3.7 8.1-3.3 11.6 0 .2 0 .5.1.8.3 3.5.9 11.7 10.6 18.8.3.2.8.2 1-.2.2-.3.2-.8-.2-1-9.2-6.7-9.8-14.4-10-17.7 0-.3 0-.6-.1-.8-.3-3.2.5-7.7 3-10.5.8-.8 1.7-1.5 2.6-1.9h155.7c1 .4 1.9 1.1 2.6 1.9 2.5 2.8 3.3 7.3 3 10.5 0 .2 0 .5-.1.8-.3 3.6-1 13.1-13.8 20.1-.3.2-.5.6-.3 1 .1.2.4.4.6.4.1 0 .2 0 .3-.1 13.5-7.5 14.3-17.5 14.6-21.3 0-.3 0-.5.1-.8.4-3.5-.5-8.5-3.3-11.6l-.6-.6c1.3.4 2.5 1.1 3.4 2.1 2.6 2.9 3.5 7.9 3.1 11.3 0 .3 0 .6-.1.9-1.5 20.9-23.6 31.4-65.5 31.4h-43.8c-41.8 0-63.9-10.5-65.4-31.4zm91 89.1h-7c0-1.5 0-3-.1-4.2-.2-12.5-2.2-31.1-2.7-35.1h3.6c.8 0 1.4-.6 1.4-1.4v-14.1h2.4v14.1c0 .8.6 1.4 1.4 1.4h3.7c-.4 3.9-2.4 22.6-2.7 35.1v4.2zm65.3 11.9h-16.8c-.4 0-.7.3-.7.7 0 .4.3.7.7.7h16.8v2.8h-62.2c0-.9-.1-1.9-.1-2.8h33.9c.4 0 .7-.3.7-.7 0-.4-.3-.7-.7-.7h-33.9c-.1-3.2-.1-6.3-.1-9h62.5v9zm-12.5 24.4h-6.3l.2-1.6h5.9l.2 1.6zm-5.8-4.5l1.6-12.3h2l1.6 12.3h-5.2zm-57-19.9h-62.4v-9h62.5c0 2.7 0 5.8-.1 9zm-62.4 1.4h62.4c0 .9-.1 1.8-.1 2.8H194v-2.8zm65.2 0h7.3c0 .9.1 1.8.1 2.8H259c.1-.9.1-1.8.1-2.8zm7.2-1.4h-7.2c.1-3.2.1-6.3.1-9h7c0 2.7 0 5.8.1 9zm-7.7-66.7v6.8h-9v-6.8h9zm-8.9 8.3h9v.7h-9v-.7zm0 2.1h9v2.3h-9v-2.3zm26-1.4h-9v-.7h9v.7zm-9 3.7v-2.3h9v2.3h-9zm9-5.9h-9v-6.8h9v6.8zm-119.3 91.1c-2.1-7.1-3-40.9-.9-53.6 2.2-13.5 11.9-28.6 17.8-35.6 5.6-6.5 13.5-15.7 15.7-18.3 11.4 6.4 28.7 9.6 51.8 9.6h6v14.1c0 .8.6 1.4 1.4 1.4h5.4c.3 3.1 2.4 22.4 2.7 35.1 0 1.2.1 2.6.1 4.2h-63.9c-.8 0-1.4.6-1.4 1.4v16.1c0 .8.6 1.4 1.4 1.4H256c-.8 11.8-2.8 24.7-8 33.3-2.6 4.4-4.9 8.5-6.9 12.2-.4.7-.1 1.6.6 1.9.2.1.4.2.6.2.5 0 1-.3 1.3-.8 1.9-3.7 4.2-7.7 6.8-12.1 5.4-9.1 7.6-22.5 8.4-34.7h7.8c.7 11.2 2.6 23.5 7.1 32.4.2.5.8.8 1.3.8.2 0 .4 0 .6-.2.7-.4 1-1.2.6-1.9-4.3-8.5-6.1-20.3-6.8-31.1H312l-2.4 18.6c-.1.4.1.8.3 1.1.3.3.7.5 1.1.5h9.6c.4 0 .8-.2 1.1-.5.3-.3.4-.7.3-1.1l-2.4-18.6H333c.8 0 1.4-.6 1.4-1.4v-16.1c0-.8-.6-1.4-1.4-1.4h-63.9c0-1.5 0-2.9.1-4.2.2-12.7 2.3-32 2.7-35.1h5.2c.8 0 1.4-.6 1.4-1.4v-14.1h6.2c23.1 0 40.4-3.2 51.8-9.6 2.3 2.6 10.1 11.8 15.7 18.3 5.9 6.9 15.6 22.1 17.8 35.6 2.2 13.4 2 43.2-1.1 53.1-1.2 3.9-1.4 8.7-1 13-1.7-2.8-2.9-4.4-3-4.6-.2-.3-.6-.5-.9-.6h-.5c-.2 0-.4.1-.5.2-.6.5-.8 1.4-.3 2 0 0 .2.3.5.8 1.4 2.1 5.6 8.4 8.9 16.7h-42.9v-43.8c0-.8-.6-1.4-1.4-1.4s-1.4.6-1.4 1.4v44.9c0 .1-.1.2-.1.3 0 .1 0 .2.1.3v9c-1.1 2-3.9 3.7-10.5 3.7h-7.5c-.4 0-.7.3-.7.7 0 .4.3.7.7.7h7.5c5 0 8.5-.9 10.5-2.8-.1 3.1-1.5 6.5-10.5 6.5H210.4c-9 0-10.5-3.4-10.5-6.5 2 1.9 5.5 2.8 10.5 2.8h67.4c.4 0 .7-.3.7-.7 0-.4-.3-.7-.7-.7h-67.4c-6.7 0-9.4-1.7-10.5-3.7v-54.5c0-.8-.6-1.4-1.4-1.4s-1.4.6-1.4 1.4v43.8h-43.6c4.2-10.2 9.4-17.4 9.5-17.5.5-.6.3-1.5-.3-2s-1.5-.3-2 .3c-.1.2-1.4 2-3.2 5 .1-4.9-.4-10.2-1.1-12.8zm221.4 60.2c-1.5 8.3-14.9 12-26.6 12H174.4c-11.8 0-25.1-3.8-26.6-12-1-5.7.6-19.3 4.6-30.2H197v9.8c0 6.4 4.5 9.7 13.4 9.7h105.4c8.9 0 13.4-3.3 13.4-9.7v-9.8h44c4 10.9 5.6 24.5 4.6 30.2z"></path><path d="M286.1 359.3c0 .4.3.7.7.7h14.7c.4 0 .7-.3.7-.7 0-.4-.3-.7-.7-.7h-14.7c-.3 0-.7.3-.7.7zm5.3-145.6c13.5-.5 24.7-2.3 33.5-5.3.4-.1.6-.5.4-.9-.1-.4-.5-.6-.9-.4-8.6 3-19.7 4.7-33 5.2-.4 0-.7.3-.7.7 0 .4.3.7.7.7zm-11.3.1c.4 0 .7-.3.7-.7 0-.4-.3-.7-.7-.7H242c-19.9 0-35.3-2.5-45.9-7.4-.4-.2-.8 0-.9.3-.2.4 0 .8.3.9 10.8 5 26.4 7.5 46.5 7.5h38.1zm-7.2 116.9c.4.1.9.1 1.4.1 1.7 0 3.4-.7 4.7-1.9 1.4-1.4 1.9-3.2 1.5-5-.2-.8-.9-1.2-1.7-1.1-.8.2-1.2.9-1.1 1.7.3 1.2-.4 2-.7 2.4-.9.9-2.2 1.3-3.4 1-.8-.2-1.5.3-1.7 1.1s.2 1.5 1 1.7z"></path><path d="M275.5 331.6c-.8 0-1.4.6-1.5 1.4 0 .8.6 1.4 1.4 1.5h.3c3.6 0 7-2.8 7.7-6.3.2-.8-.4-1.5-1.1-1.7-.8-.2-1.5.4-1.7 1.1-.4 2.3-2.8 4.2-5.1 4zm5.4 1.6c-.6.5-.6 1.4-.1 2 1.1 1.3 2.5 2.2 4.2 2.8.2.1.3.1.5.1.6 0 1.1-.3 1.3-.9.3-.7-.1-1.6-.8-1.8-1.2-.5-2.2-1.2-3-2.1-.6-.6-1.5-.6-2.1-.1zm-38.2 12.7c.5 0 .9 0 1.4-.1.8-.2 1.3-.9 1.1-1.7-.2-.8-.9-1.3-1.7-1.1-1.2.3-2.5-.1-3.4-1-.4-.4-1-1.2-.8-2.4.2-.8-.3-1.5-1.1-1.7-.8-.2-1.5.3-1.7 1.1-.4 1.8.1 3.7 1.5 5 1.2 1.2 2.9 1.9 4.7 1.9z"></path><path d="M241.2 349.6h.3c.8 0 1.4-.7 1.4-1.5s-.7-1.4-1.5-1.4c-2.3.1-4.6-1.7-5.1-4-.2-.8-.9-1.3-1.7-1.1-.8.2-1.3.9-1.1 1.7.7 3.5 4.1 6.3 7.7 6.3zm-9.7 3.6c.2 0 .3 0 .5-.1 1.6-.6 3-1.6 4.2-2.8.5-.6.5-1.5-.1-2s-1.5-.5-2 .1c-.8.9-1.8 1.6-3 2.1-.7.3-1.1 1.1-.8 1.8 0 .6.6.9 1.2.9z"></path></svg>
      {% endif %}

      {% unless onboarding %}
        <a href="{{ product.url | within: collection }}{{variant_url}}" class="{% if media_borders %}with-border{% endif %}"></a>
      {% endunless %}

      <{% if onboarding %}div{% else %}a{% endif %}
        class="
          product-card-overlay
          {% if enableQuickshop == false and enableATC == false and enable_product_details_overlay == false %}product-card-overlay--hide{% endif %}"
        {% unless onboarding %}href="{{ product.url | within: collection }}{{variant_url}}"{% endunless %}
      >
        <div class="product-card-overlay-content">
          {% if settings.enable_product_details_overlay %}
            {{ product_card_details_overlay }}
          {% else %}
            {{ product_card_interactions }}
          {% endif %}
        </div>
      </{% if onboarding %}div{% else %}a{% endif %}>
    {% assign itemType = product %}
      <div class="badges-wrapper">
        {% if itemType.available %}
          {% if itemType.compare_at_price_min > itemType.price_min %}
            <span class="badge badge-sale">{% endraw %}{{ 'products.product.on_sale' | t }}{% raw %}</span>
          {% endif %}

          {% capture new-tag %}{% endraw %}{{ 'products.product.new' | t }}{% raw %}{% endcapture %}
          {% if product.tags contains new-tag %}
            <span class="badge badge-new">{{ new-tag }}</span>
          {% endif %}
        {% else %}
          <span class="badge badge-soldout">{% endraw %}{{ 'products.product.sold_out' | t }}{% raw %}</span>
        {% endif %}
      </div>
    </figure>

    <div class="product-card-footer">
      {% if settings.enable_product_details_overlay %}
        {{ product_card_interactions }}
      {% else %}
        {{ product_card_details }}
      {% endif %}
    </div>

    <div class="product-card-footer-mobile">
      {{ product_card_details }}
    </div>
  </div>
  </li>
      {% endraw %}
